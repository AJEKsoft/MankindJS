<!DOCTYPE html>

<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,
				   user-scalable=no,
				   maximum-scale=1.0,
				   minimum-scale=1.0">
    <title>MankindJS</title>
    
    <link rel="stylesheet" href="res/index.css">

    <!-- Shaders. -->
    <script type="x-shader/x-vertex" id="default.vs">
      #version 300 es

      in ivec3 position;
      in float color;

      out vec4 vertexColor;

      uniform mat4 model, view, projection;
      uniform vec3 eye;

      const float pointsize = 1000.0;
      const int chunksize = 8;
      
      void main ()
      {
	  ivec3 pos = position;
	  // hardcoded... make the 16 be an uniform or sum bull
	  // Maybe use gl_VertexID and no instancing?
	  pos.z += gl_InstanceID % chunksize;	  
	  pos.x += gl_InstanceID / (chunksize * chunksize);

	  int y = (gl_InstanceID / chunksize) % chunksize;
	  pos.y += y;

	  // This fills out the space inbetween chunk layers.
	  
	  if (y % 2 == 0)
	  {
	      pos.z += 1;
	      pos.x += 1;
	  }

	  
	  gl_Position = projection * view * model * vec4(pos, 1.0);
	  gl_PointSize = pointsize;

	  vertexColor = vec4 (color, 1.0, color, 1.0);
      }
    </script>
    
    <script type="x-shader/x-fragment" id="default.fs">
      #version 300 es

      precision mediump float;

      in vec4 vertexColor;
      
      out vec4 color;

      void main ()
      {
	  vec2 circCoord = 2.0 * gl_PointCoord - 1.0;

	  if (dot (circCoord, circCoord) > 1.0)
	  {
	      discard;
	  }
	  
	  color = vertexColor;
      }
    </script>
    
    <!-- Code. -->
    <script type="text/javascript" src="src/utilities.js"></script>
    <script type="text/javascript" src="src/chunk.js"></script>
    <script type="text/javascript" src="src/camera.js"></script>
    <script type="text/javascript" src="src/mesh.js"></script>
    <script type="text/javascript" src="src/program.js"></script>
    <script type="text/javascript" src="src/index.js"></script>
  </head>

  <body>
    <canvas id="canvas"></canvas>
  </body>
</html>
